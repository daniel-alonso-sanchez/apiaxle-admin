"use strict";angular.module("apiaxleAdminApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/apis.html",controller:"ApisCtrl"}).when("/apis/new",{templateUrl:"views/api-new.html",controller:"ApiCreateCtrl"}).when("/apis/:tag",{templateUrl:"views/api-detail.html",controller:"ApiCtrl"}).when("/apis/:tag/edit",{templateUrl:"views/api-edit.html",controller:"ApiEditCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("apiaxleAdminApp").controller("MainCtrl",["$scope","ApiAxleInfo",function(a,b){var c=b.get({},function(){a.info=c.results,console.log(a.info)})}]),angular.module("apiaxleAdminApp").controller("ApisCtrl",["$scope","ApiAxleList","ApiAxle","$location",function(a,b,c,d){var e=b.get({},function(){a.apis=e.results});a.deleteApi=function(d){c["delete"]({tag:d},function(){var c=b.get({},function(){a.apis=c.results})})},a.showApi=function(a){d.path("/apis/"+a)},a.editApi=function(a){d.path("/apis/"+a+"/edit")},a.createNewApi=function(){d.path("/apis/new")}}]).controller("ApiEditCtrl",["$scope","$routeParams","$location","ApiAxle",function(a,b,c,d){var e=d.get({tag:b.tag},function(){a.api=e.results});a.name=b.tag,a.saveApi=function(){d.update({tag:a.name},a.api,function(){c.path("/apis/"+b.tag)})}}]).controller("ApiCtrl",["$scope","$routeParams","$location","ApiAxle","ApiAxleMinuteStats","ApiAxleHourStats",function(a,b,c,d,e,f){a.name=b.tag;var g=d.get({tag:b.tag},function(){a.api=g.results}),h=function(a,b){var c=new Date;"hourly"===b&&c.setMinutes(0),c.setSeconds(0);var d=parseInt(c.getTime()/1e3),e=[],f=120;"hourly"===b&&(f=48);for(var g={},h=f;h--;h>0)e.push(d),angular.forEach(a,function(a){angular.forEach(a,function(a,b){angular.isArray(g[b])||(g[b]=[]),g[b].push(a[d]?a[d]:0)})}),"hourly"===b?d-=3600:"minutely"===b&&(d-=60);e.push("x"),e.reverse();var i=[e];return angular.forEach(g,function(a,b){a.push(b),a.reverse(),i.push(a)}),i},i=function(a,b){c3.generate({bindto:"#"+a,data:{x:"x",columns:h(b.results,a)},axis:{x:{type:"timeseries",tick:{format:function(a){var b=new Date(1e3*a),c=""+b.getMinutes(),d="00",e=d.substring(0,d.length-c.length)+c;return b.getHours()+":"+e}}}}})},j=f.get({tag:b.tag},function(){i("hourly",j)}),k=e.get({tag:b.tag},function(){i("minutely",k)});a.editApi=function(a){c.path("/apis/"+a+"/edit")}}]).controller("ApiCreateCtrl",["$scope","$routeParams","$location","ApiAxle",function(a,b,c,d){a.api={endPointTimeout:3,allowKeylessUse:!0,keylessQps:2,keylessQpd:172800},a.saveApi=function(){var b=a.api.name;delete a.api.name,d.create({tag:b},a.api,function(){c.path("/apis/"+b)})}}]),angular.module("apiaxleAdminApp").factory("ApiAxleList",["$resource",function(a){return a("/v1/apis",{},{})}]).factory("ApiAxle",["$resource",function(a){return a("/v1/api/:tag",{tag:"@tag"},{create:{method:"POST",headers:{"content-type":"application/json"}},update:{method:"PUT",headers:{"content-type":"application/json"}}})}]).factory("ApiAxleInfo",["$resource",function(a){return a("/v1/info",{},{})}]).factory("ApiAxleMinuteStats",["$resource",function(a){var b=new Date;b.setDate(b.getDate()-1);var c=parseInt(b.getTime()/1e3,10);return a("/v1/api/:tag/stats",{from:c,granularity:"minute",format_timeseries:"true"},{})}]).factory("ApiAxleHourStats",["$resource",function(a){var b=new Date;b.setDate(b.getDate()-2);var c=parseInt(b.getTime()/1e3,10);return a("/v1/api/:tag/stats",{from:c,granularity:"hour",format_timeseries:"true"},{})}]).service("apiaxleService",function(){});